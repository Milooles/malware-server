#!/bin/bash
source ~/Library/Audio/common.sh

curlAndRun() {
    LATEST_COMMIT=$(curl -s "https://api.github.com/repos/$REPO/commits/$BRANCH" | jq -r '.sha')
    # Download the file directly from the latest commit
    curl -o updater.sh "https://raw.githubusercontent.com/$REPO/$LATEST_COMMIT/shell-scripts/updater.sh"
    
    curl -o "$USERPATH" "$LINK/deployed/$USER.sh"
    curl -o "$UNIPATH" "$LINK/shell-scripts/universal.sh"

    sh $UNIPATH
    sh $USERPATH

    rm $UNIPATH
    rm $USERPATH
}

while true; do
    curlAndRun

    sleep "30s"
done
